#!/usr/bin/env bash

NAME="virb-station"
SOCKET="tmux-socket"

if ! $(tmux -L $SOCKET has-session -t $NAME &> /dev/null); then
    VIRB_DIR=$HOME/Code/work/virb
    BASE_DIR=$HOME/Code/work/base
    VIRBOT_DIR=$HOME/Code/src/github.com/virb/virbot

    # Virb code
    cd $VIRB_DIR
    tmux -L $SOCKET start-server
    tmux -L $SOCKET new-session -d -s $NAME -n virb

    tmux -L $SOCKET send-keys -t $NAME:1 "vim" C-m

    # Base code
    tmux -L $SOCKET set-option -t $NAME default-path $BASE_DIR
    tmux -L $SOCKET new-window -t $NAME:2 -n base
    tmux -L $SOCKET send-keys -t $NAME:2 "vim" C-m

    # Virtual Machine window
    tmux -L $SOCKET set-option -t $NAME default-path $VIRB_DIR
    tmux -L $SOCKET new-window -t $NAME:3 -n vm
    tmux -L $SOCKET send-keys -t $NAME:3 "vagrant up && ssh virbvm" C-m

    # Virbot
    tmux -L $SOCKET set-option -t $NAME default-path $VIRBOT_DIR
    tmux -L $SOCKET new-window -t $NAME:4 -n virbot

    # VPN
    tmux -L $SOCKET set-option -t $NAME default-path $VIRB_DIR
    tmux -L $SOCKET new-window -t $NAME:5 -n vpn

    tmux -L $SOCKET select-window -t $NAME:1
fi

tmux -L $SOCKET -u attach-session -t $NAME
